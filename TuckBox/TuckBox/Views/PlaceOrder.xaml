<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="TuckBox.Views.PlaceOrder"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:models="clr-namespace:TuckBox.Models"
    Title="Place Order">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="16">

            <Label x:Name="StatusLabel" Text="Loading..." FontAttributes="Bold" />

            <Picker x:Name="CityPicker" Title="Select City" />

            <Picker x:Name="SlotPicker" Title="Select Delivery Time Slot" />

            <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                <Picker x:Name="AddressPicker" Title="Select Delivery Address" HorizontalOptions="FillAndExpand" />
                <Button Text="ADD" Clicked="OnAddAddressClicked" />
            </HorizontalStackLayout>

            <CollectionView x:Name="FoodsList" ItemsLayout="VerticalList">
                <CollectionView.ItemTemplate>
                    <!-- x:DataType is optional; keep for compile-time checks -->
                    <DataTemplate x:DataType="models:Food">
                        <Frame Padding="12" Margin="0,6" BorderColor="#cccccc" CornerRadius="10">
                            <VerticalStackLayout x:Name="RowRoot" Spacing="10">
                                <Label Text="{Binding Food_Name}" FontAttributes="Bold" FontSize="18"/>
                                <Label Text="{Binding Description}" FontSize="14" TextColor="Gray"/>

                                <!-- Options using native RadioButtons via BindableLayout -->
                                <VerticalStackLayout Spacing="6">
                                    <Label Text="{Binding Option_Key}" FontAttributes="Bold"/>
                                    <HorizontalStackLayout
                                        x:Name="OptionsHost"
                                        Spacing="12"
                                        BindableLayout.ItemsSource="{Binding Option_Values}">
                                        <BindableLayout.ItemTemplate>
                                            <DataTemplate>
                                                <RadioButton
                                                    Content="{Binding .}"
                                                    Value="{Binding .}"
                                                    GroupName="{Binding Source={x:Reference RowRoot}, Path=BindingContext.Food_ID}"
                                                    CheckedChanged="OnOptionChecked" />
                                            </DataTemplate>
                                        </BindableLayout.ItemTemplate>
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>

                                <!-- Quantity row -->
                                <HorizontalStackLayout Spacing="12" VerticalOptions="Center">
                                    <Button Text="-" WidthRequest="44" Clicked="OnMinusClicked"/>
                                    <Label x:Name="QtyLabel"
                                           Text="0"
                                           FontAttributes="Bold"
                                           FontSize="18"
                                           WidthRequest="32"
                                           HorizontalTextAlignment="Center"/>
                                    <Button Text="+" WidthRequest="44" Clicked="OnPlusClicked"/>
                                    <Label Text="{Binding Price, StringFormat='${0:F2}'}"
                                           FontAttributes="Bold" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Button Text="Place Order" Clicked="OnPlaceOrderClicked" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
